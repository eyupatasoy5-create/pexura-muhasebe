<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>PEXURA Tech</title>
  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="PEXURA Tech">

  <link rel="stylesheet" href="style.css">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
<header>
  <div class="header-left">
      <h1 onclick="document.querySelector('button[data-tab=\'dash\']').click()" style="cursor: pointer;">PEXURA Tech</h1>
      <div class="view-mode-switch">
          <button onclick="setAppView('pc')" title="PC GÃ¶rÃ¼nÃ¼mÃ¼">ğŸ’»</button>
          <button onclick="setAppView('mobile')" title="Mobil GÃ¶rÃ¼nÃ¼m">ğŸ“±</button>
      </div>
  </div>

  <div class="header-center">
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="MÃ¼ÅŸteri, Tel, Mail veya ÃœrÃ¼n ara..." onkeypress="if(event.key==='Enter') globalSearch()">
        <button onclick="globalSearch()">ğŸ”</button>
    </div>
  </div>

  <div class="header-right">
      <input type="file" id="importFile" accept=".json" style="display:none" />
      <div class="action-group">
          <button id="restoreBtn" class="group-btn warning">ğŸ“‚ YÃ¼kle</button>
          <button id="backupBtn" class="group-btn success">ğŸ’¾ Yedek Al</button>
          <button onclick="openTimeMachine()" class="group-btn info">âª Zaman</button>
      </div>
  </div>
</header>

<div class="authbar">
  <div id="authLoggedOut">
    <input id="authEmail" placeholder="E-posta"/>
    <input id="authPass" type="password" placeholder="Åifre"/>
    <button class="primary" id="btnRegister">KayÄ±t Ol</button>
    <button id="btnLogin">GiriÅŸ</button>
  </div>
  <div id="authLoggedIn" class="hide">
    <span id="authUserMail"></span>
    <button id="btnLogout">Ã‡Ä±kÄ±ÅŸ</button>
  </div>
</div>

<div class="wrap">
  <nav>
    <button class="navbtn active" data-tab="dash">ğŸ“Š Dashboard</button>
    <button class="navbtn" data-tab="faturalar">ğŸ§¾ Fatura Kes</button>
    <button class="navbtn" data-tab="cariler">ğŸ‘¥ MÃ¼ÅŸteriler</button>
    <button class="navbtn" data-tab="urunler">ğŸ“¦ ÃœrÃ¼nler</button>
    <button class="navbtn" data-tab="kasa">ğŸ’° Kasa</button>
    <button class="navbtn" data-tab="gelirgider">ğŸ“‰ Gelir/Gider</button>
    <button class="navbtn" data-tab="gecmis">ğŸ•’ Ä°ÅŸlem GeÃ§miÅŸi</button>
  </nav>

  <main>
    <section id="tab-dash" class="tab">
      <div class="grid">
        <div class="card" style="grid-column: span 12; display:flex; align-items:center; gap:15px; background: rgba(59, 130, 246, 0.1); border-color: #3b82f6;">
            <h3 style="margin:0; border:none; color: #60a5fa;">Para Birimi:</h3>
            <select id="dashCurrencySelect" style="width: auto; min-width: 150px; margin:0;">
                <option value="USD" selected>$ Dolar</option>
            </select>
        </div>
        <div class="card kpi"><div class="label">ÃœrÃ¼n Ã‡eÅŸidi & DeÄŸeri</div><div class="val" id="dashStokDeger">0</div></div>
        <div class="card kpi"><div class="label">Toplam SatÄ±ÅŸ</div><div class="val" id="dashToplamSatis">0</div></div>
        <div class="card kpi"><div class="label">Net Kasa</div><div class="val" id="dashNakit">0</div></div>
        <div class="card" style="grid-column: span 6;"><h2>Kritik Stok</h2><table><thead><tr><th>ÃœrÃ¼n</th><th>Mevcut</th><th>Min</th></tr></thead><tbody id="dashKritikListe"></tbody></table></div>
        <div class="card" style="grid-column: span 6;"><h2>Son Ä°ÅŸlemler</h2><table><thead><tr><th>Tarih</th><th>TÃ¼r</th><th>Tutar</th></tr></thead><tbody id="dashSonHareketler"></tbody></table></div>
      </div>
    </section>

    <section id="tab-faturalar" class="tab hide">
      <div class="grid">
        <div class="card" style="grid-column: span 5;">
          <h2>Yeni Fatura</h2>
          <select id="fTip"><option value="satis">SatÄ±ÅŸ FaturasÄ±</option><option value="alis">AlÄ±ÅŸ FaturasÄ±</option></select>
          <div class="row"><select id="fPara"><option value="USD" selected>USD</option></select><input id="fNo" placeholder="Belge No"/></div>
          <input id="fTarih" type="date"/>
          <label>Ã–deme Durumu</label><select id="fDurum" style="margin-bottom: 10px; border-color: #f59e0b;"><option value="Odenmedi">ğŸ”´ Ã–denmedi</option><option value="Odendi">ğŸŸ¢ Ã–dendi</option></select>
          <select id="fCari"></select>
          <div style="margin: 15px 0; padding: 10px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;">
            <label style="display:flex; align-items:center; gap: 8px; cursor:pointer; color: #22c55e;"><input type="checkbox" id="fWhatsappCheck" checked style="width: auto;">WhatsApp GÃ¶nder</label>
          </div>
          <hr style="border-color: rgba(255,255,255,0.1); margin: 15px 0;">
          <label>ÃœrÃ¼n SeÃ§imi</label><select id="kUrun"></select>
          <div class="row"><input id="kMiktar" type="number" placeholder="Miktar"/><input id="kFiyat" type="number" placeholder="Fiyat"/></div>
          <div class="row"><input id="kKdv" type="number" value="18" placeholder="KDV %"/><button id="kalemEkleBtn">Ekle</button></div>
          <h3 style="text-align:right; font-size: 20px;">Toplam: <span id="fGenel">0</span></h3>
          <button class="success" style="width:100%" id="fKaydetBtn">FATURAYI ONAYLA</button>
        </div>
        <div class="card" style="grid-column: span 7;">
          <h2>Kalemler</h2><table><tbody id="kalemListe"></tbody></table><br>
          <h2>GeÃ§miÅŸ Faturalar</h2><table><thead><tr><th>Tarih</th><th>MÃ¼ÅŸteri</th><th>Durum</th><th>Tutar</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="faturaListe"></tbody></table>
        </div>
      </div>
    </section>

    <section id="tab-cariler" class="tab hide">
      <div class="grid">
        <div class="card" style="grid-column: span 4;">
          <h2>Cari Ekle</h2>
          <select id="cariTur"><option value="musteri">MÃ¼ÅŸteri</option><option value="tedarikci">TedarikÃ§i</option></select>
          <input id="cariAd" placeholder="Firma / Ad Soyad"/><input id="cariTel" placeholder="Telefon"/><input id="cariMail" placeholder="E-posta"/><textarea id="cariAdres" placeholder="Adres"></textarea>
          <div class="row"><input id="cariABorc" type="number" placeholder="AÃ§Ä±lÄ±ÅŸ BorÃ§"/><input id="cariAAlacak" type="number" placeholder="AÃ§Ä±lÄ±ÅŸ Alacak"/></div>
          <button class="primary" style="width:100%; margin-top:10px;" id="cariEkleBtn">Kaydet</button>
        </div>
        <div class="card" style="grid-column: span 8;">
          <h2>Cari Listesi</h2><table><thead><tr><th>Ãœnvan / Tel</th><th>TÃ¼r</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="cariListe"></tbody></table>
        </div>
      </div>
    </section>

    <section id="tab-urunler" class="tab hide">
      <div class="grid">
        <div class="card" id="uEkleCard" style="grid-column: span 4;">
          <h2>ÃœrÃ¼n Ekle</h2>
          <div id="uResimPreviewArea" class="img-preview-box hide">
              <img id="uResimPreview" src="" alt="Onizleme">
              <div style="flex:1"><span style="font-size:11px; display:block; color:#94a3b8">Mevcut Resim</span><button type="button" class="btn-remove-img" onclick="removeCurrentImage()">KaldÄ±r</button></div>
          </div>
          <label>GÃ¶rsel (Opsiyonel)</label><input type="file" id="uResimInput" accept="image/*" style="padding: 5px;"/>
          <input id="uKod" placeholder="ÃœrÃ¼n Kodu"/><input id="uAd" placeholder="ÃœrÃ¼n AdÄ±"/>
          <div class="row"><input id="uBirim" placeholder="Birim"/><select id="uPara"><option value="USD" selected>USD</option></select></div>
          <div class="row"><input id="uAlis" type="number" placeholder="AlÄ±ÅŸ Fiyat"/><input id="uSatis" type="number" placeholder="SatÄ±ÅŸ Fiyat"/></div>
          <div class="row"><input id="uMin" type="number" placeholder="Min Stok"/><input id="uStokManuel" type="number" placeholder="BaÅŸlangÄ±Ã§ Stok"/></div>
          <input id="uKdv" type="number" value="0" placeholder="KDV"/>
          <button class="primary" style="width:100%; margin-top:10px;" id="uKaydetBtn">Kaydet</button>
        </div>
        <div class="card" style="grid-column: span 8;">
          <h2>ÃœrÃ¼nler</h2><table><thead><tr><th>Resim</th><th>Kod</th><th>Ad</th><th>Stok</th><th>Fiyat</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="uListe"></tbody></table>
        </div>
      </div>
    </section>

    <section id="tab-kasa" class="tab hide">
      <div class="grid">
        <div class="card" style="grid-column: span 5;">
          <h2>Hesap Ekle</h2>
          <input id="hAd" placeholder="Hesap AdÄ±"/><select id="hTur"><option value="kasa">Kasa</option><option value="banka">Banka</option></select>
          <select id="hPara"><option value="USD" selected>USD</option></select>
          <input id="hAc" type="number" placeholder="AÃ§Ä±lÄ±ÅŸ Bakiye"/>
          <button class="primary" style="margin-top:10px" id="hEkleBtn">Hesap OluÅŸtur</button>
          <hr style="border-color: rgba(255,255,255,0.1); margin: 20px 0;">
          <h2>Ä°ÅŸlem Gir</h2>
          <select id="kHesap"></select><select id="kTur"><option value="tahsilat">Tahsilat</option><option value="odeme">Ã–deme</option></select>
          <input id="kTutar" type="number" placeholder="Tutar"/><input id="kTarih" type="date"/><select id="kCari"></select>
          <input id="kAciklama" placeholder="AÃ§Ä±klama"/>
          <button class="success" style="width:100%; margin-top:10px" id="kEkleBtn">Ä°ÅŸlemi Kaydet</button>
        </div>
        <div class="card" style="grid-column: span 7;">
          <h2>Hesaplar</h2><table><tbody id="hesapListe"></tbody></table><br>
          <h2>Hareketler</h2><table><tbody id="hareketListe"></tbody></table>
        </div>
      </div>
    </section>

    <section id="tab-gelirgider" class="tab hide">
      <div class="grid">
         <div class="card" style="grid-column: span 4;">
           <h2>Gelir/Gider Ekle</h2>
           <select id="ggTur"><option value="gider">Gider</option><option value="gelir">Gelir</option></select>
           <input id="ggKat" placeholder="Kategori"/><input id="ggTutar" type="number" placeholder="Tutar"/><input id="ggAc" placeholder="AÃ§Ä±klama"/><input id="ggTarih" type="date"/>
           <button class="primary" style="margin-top:10px" id="ggEkleBtn">Ekle</button>
         </div>
         <div class="card" style="grid-column: span 8;"><table><tbody id="ggListe"></tbody></table></div>
      </div>
    </section>

    <section id="tab-gecmis" class="tab hide">
      <div class="card" style="grid-column: span 12;">
          <div style="display:flex; flex-wrap:wrap; justify-content:space-between; align-items:center; margin-bottom:20px; gap:10px;">
            <h2 style="border:none; margin:0;">TÃ¼m Ä°ÅŸlem GeÃ§miÅŸi</h2>
            <div style="display:flex; gap:10px; align-items:center;">
                <input type="text" id="historySearch" placeholder="Ä°ÅŸlem ara..." style="width:250px; margin:0;" onkeyup="renderHistory()">
                <button class="danger" style="padding: 10px 15px;" onclick="clearAllHistory()">ğŸ—‘ï¸ TÃ¼mÃ¼nÃ¼ Temizle</button>
            </div>
          </div>
          <table>
            <thead>
                <tr>
                    <th>Tarih</th>
                    <th>Kaynak</th>
                    <th>AÃ§Ä±klama / Cari</th>
                    <th>Tutar</th>
                    <th>Ä°ÅŸlem</th>
                </tr>
            </thead>
            <tbody id="historyList"></tbody>
          </table>
      </div>
    </section>
  </main>
</div>

<div id="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>

<div id="modalImageView" class="modal-overlay hide" onclick="closeImageModal()">
    <div class="modal-content" style="background:transparent; border:none; box-shadow:none; text-align:center; display:flex; justify-content:center; align-items:center;">
        <img id="imgBigPreview" src="" style="max-width:90%; max-height:85vh; border-radius:12px; box-shadow: 0 0 30px rgba(0,0,0,0.8);">
    </div>
</div>

<div id="modalEkstre" class="modal-overlay hide">
  <div class="modal-content">
    <button class="modal-close" onclick="closeEkstre()">&times;</button>
    <h2 id="ekstreBaslik">Ekstre</h2>
    <div class="ekstre-summary">
        <div class="ekstre-box"><h4>TOPLAM BORÃ‡ (SATIÅ)</h4><span id="ekstreAlim" style="color:#60a5fa">0 $</span></div>
        <div class="ekstre-box"><h4>TOPLAM Ã–DENEN</h4><span id="ekstreOdeme" style="color:#f59e0b">0 $</span></div>
        <div class="ekstre-box"><h4>KALAN BAKÄ°YE</h4><span id="ekstreBakiye">0 $</span></div>
    </div>
    <h3>ğŸ“¦ ÃœrÃ¼n Hareketleri</h3>
    <table style="margin-bottom:20px;"><thead><tr><th>Tarih</th><th>ÃœrÃ¼n</th><th>Miktar</th><th>B.Fiyat</th><th>Tutar</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="ekstreUrunler"></tbody></table>
    <h3>ğŸ’° Ã–demeler / Finans</h3>
    <table><thead><tr><th>Tarih</th><th>Ä°ÅŸlem TÃ¼rÃ¼</th><th>Tutar</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="ekstreOdemeler"></tbody></table>
  </div>
</div>

<div id="modalSearch" class="modal-overlay hide">
  <div class="modal-content">
    <button class="modal-close" onclick="document.getElementById('modalSearch').classList.add('hide')">&times;</button>
    <h2 style="margin-top:0;">ğŸ” Arama SonuÃ§larÄ±</h2>
    <div class="search-section-title" style="color:#94a3b8; margin-top:15px; border-bottom:1px solid #334155;">ğŸ‘¥ MÃ¼ÅŸteriler</div>
    <table><thead><tr><th>Ad Soyad</th><th>Telefon</th><th>Adres</th><th>Bakiye</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="searchResultCari"></tbody></table>
    <div class="search-section-title" style="color:#94a3b8; margin-top:15px; border-bottom:1px solid #334155;">ğŸ“¦ ÃœrÃ¼nler</div>
    <table><thead><tr><th>ÃœrÃ¼n AdÄ±</th><th>Kod</th><th>Fiyat</th><th>Stok</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="searchResultUrun"></tbody></table>
  </div>
</div>

<div id="modalTimeMachine" class="modal-overlay hide">
  <div class="modal-content" style="max-width: 500px; text-align:center;">
    <button class="modal-close" onclick="document.getElementById('modalTimeMachine').classList.add('hide')">&times;</button>
    <h2 style="color:#8b5cf6; margin-top:0;">âª Zaman Makinesi</h2>
    <p style="color:#94a3b8; margin-bottom:20px;">SeÃ§ilen tarihten sonraki iÅŸlemler geri alÄ±nacaktÄ±r.</p>
    <input type="datetime-local" id="rollbackTime" style="width:100%; padding:15px; font-size:16px; margin-bottom:20px;">
    <button onclick="executeRollback()" style="background:#8b5cf6; color:white; width:100%; padding:15px;">GERÄ° DÃ–NÃœÅÃœ BAÅLAT</button>
  </div>
</div>

<div id="modalCariPanel" class="modal-overlay hide">
  <div class="modal-content" style="max-width: 900px;">
    <button class="modal-close" onclick="document.getElementById('modalCariPanel').classList.add('hide')">&times;</button>
    
    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #334155; padding-bottom:15px; margin-bottom:20px;">
        <h2 id="cpBaslik" style="margin:0; color:#60a5fa; font-size:24px;">MÃ¼ÅŸteri AdÄ±</h2>
        <div style="text-align:right;">
            <span style="font-size:12px; color:#94a3b8;">GÃ¼ncel Bakiye</span><br>
            <span id="cpBakiye" style="font-size:20px; font-weight:bold; color:#e2e8f0;">0.00 $</span>
        </div>
    </div>

    <div class="row" style="gap: 30px;">
        <div style="flex:1; background:rgba(255,255,255,0.02); padding:20px; border-radius:12px; border:1px solid #334155;">
            <h3 style="margin-top:0; color:#4ade80;">ğŸ“¦ HÄ±zlÄ± SatÄ±ÅŸ (ÃœrÃ¼n Ver)</h3>
            <label>ÃœrÃ¼n SeÃ§</label>
            <select id="cpUrunSelect" onchange="cpUrunSecildi()"></select>
            <div class="row">
                <div><label>Fiyat</label><input id="cpUrunFiyat" type="number"></div>
                <div><label>Adet</label><input id="cpUrunAdet" type="number" value="1"></div>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                <span id="cpStokDurum" style="font-size:12px; color:#94a3b8;">Stok: -</span>
                <span id="cpToplamTutar" style="font-weight:bold; font-size:16px;">0.00</span>
            </div>
            <button class="success" style="width:100%; margin-top:15px;" onclick="cpSatisYap()">SATIÅI ONAYLA & STOKTAN DÃœÅ</button>
        </div>

        <div style="flex:1; background:rgba(255,255,255,0.02); padding:20px; border-radius:12px; border:1px solid #334155;">
            <h3 style="margin-top:0; color:#f59e0b;">ğŸ’° Finansal Ä°ÅŸlem</h3>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <button id="btnTahsilat" class="primary" style="flex:1; opacity:1;" onclick="setCpFinansTur('tahsilat')">Tahsilat (Para Al)</button>
                <button id="btnOdeme" class="danger" style="flex:1; opacity:0.5;" onclick="setCpFinansTur('odeme')">Ã–deme (Para Ver)</button>
            </div>
            <input type="hidden" id="cpFinansTur" value="tahsilat">
            <label>Ä°ÅŸlenecek Tutar</label>
            <input id="cpFinansTutar" type="number" placeholder="0.00">
            <label>Kasa/Banka SeÃ§</label>
            <select id="cpKasaSelect"></select>
            <label>AÃ§Ä±klama</label>
            <input id="cpFinansAciklama" placeholder="Ã–rn: Elden Ã¶deme alÄ±ndÄ±">
            <button class="primary" style="width:100%; margin-top:15px;" onclick="cpFinansIsle()">BAKÄ°YEYÄ° GÃœNCELLE</button>
        </div>
    </div>
    
    <div style="margin-top:30px;">
        <h3>ğŸ“œ Son 5 Hareket</h3>
        <table><thead><tr><th>Tarih</th><th>Ä°ÅŸlem</th><th>Tutar</th></tr></thead><tbody id="cpGecmisListe"></tbody></table>
        <button onclick="document.getElementById('modalCariPanel').classList.add('hide'); openEkstre(ACTIVE_CARI_ID)" style="width:100%; margin-top:10px; background:transparent; border:1px dashed #475569; color:#94a3b8;">DetaylÄ± Ekstre GÃ¶rÃ¼ntÃ¼le</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="app.js"></script>
</body>
</html>